<script src="/js/partials/head.js"></script>

<!-- Page styles -->
<link rel="stylesheet" href="/css/pages/home-style.css">
<link rel="stylesheet" href="/css/pages/footer-sitemap.css">

<header class="topbar">
  <h1>TIMEOUT CLICK</h1>
</header>

<main class="poster">
  <h2 class="titles">HOME</h2>

  <div class="poster__scroll">
    <!-- Main CTA for visitors -->
    <button type="submit" class="btn btn--secondary"
            onclick="window.location.href='/pages/unregistered-challenge.html'">PLAY</button>

    <!-- Guest challenge button -->
    <button type="button" class="btn btn--secondary" id="guestChallengeBtn">
      CHALLENGE RANDOM PLAYER
    </button>

    <!-- Public leaderboard -->
    <button type="button" class="btn btn--primary-brown"
            onclick="window.location.href='/pages/unregistered-bestPlayers.html'">BEST PLAYERS</button>

    <!-- How to play -->
    <button type="button" class="btn btn--primary-brown"
            onclick="window.location.href='/pages/unregistered-instructions.html'">INSTRUCTIONS</button>

    <!-- Auth actions -->
    <div class="btn-row">
      <button type="button" class="btn" onclick="window.location.href='/pages/login.html'">LOGIN</button>
      <button type="button" class="btn" onclick="window.location.href='/pages/register.html'">SIGN UP</button>
    </div>
  </div>
</main>

<!-- Footer with sitemap -->
<footer class="footer">
  <ul class="footer-links">
    <li><a href="/pages/unregistered-sitemap.html">SITE MAP</a></li>
  </ul>
</footer>

<!-- Shared footer scripts -->
<script src="/js/partials/footer.js"></script>

<!-- Guest challenge functionality -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const guestChallengeBtn = document.getElementById('guestChallengeBtn');
  
  if (guestChallengeBtn) {
    guestChallengeBtn.addEventListener('click', async () => {
      // Disable button while processing
      guestChallengeBtn.disabled = true;
      guestChallengeBtn.textContent = 'SEARCHING...';
      
      try {
        const response = await fetch('http://localhost:3000/api/games/guest-challenge', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (data.success) {
          if (data.emailPreview) {
            console.log('Email preview:', data.emailPreview);
          }
          
          // Redirect guest immediately to duel page to wait
          window.location.href = `/pages/duel.html?gameId=${data.gameId}&guest=true&opponent=${encodeURIComponent(data.opponent)}`;
        } else {
          alert(data.message || 'No players available at the moment. Please try again later.');
          guestChallengeBtn.disabled = false;
          guestChallengeBtn.textContent = 'CHALLENGE RANDOM PLAYER';
        }
      } catch (error) {
        console.error('Guest challenge error:', error);
        alert('Failed to send challenge. Please try again.');
        guestChallengeBtn.disabled = false;
        guestChallengeBtn.textContent = 'CHALLENGE RANDOM PLAYER';
      }
    });
  }
});
</script>