<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script src="/js/partials/head.js"></script>
<script src="/js/partials/navbar.js"></script>
<script src="/js/utils/api-client.js"></script>
<script src="/js/utils/auth-manager.js"></script>
<script src="/js/utils/popup-manager.js"></script>

<script>window.NAV_ACTIVE = "start";</script>
<script src="/js/utils/activeTab.js" defer></script>

<!-- Duel page styles -->
<link rel="stylesheet" href="/css/pages/duel-styles/main-side.css">
<link rel="stylesheet" href="/css/pages/duel-styles/click-btn.css">
<link rel="stylesheet" href="/css/pages/duel-styles/popups-styles.css">
<link rel="stylesheet" href="/css/pages/duel-styles/duel-side.css">
<link rel="stylesheet" href="/css/pages/duel-styles/footer.css">

<main class="duel-page">
  <div class="principal">
    <section class="duel-content">
      <!-- Round + target time -->
      <div class="round-goal-centered">
        <div class="round-info">
          <span class="round-label">ROUND</span>
          <span class="round-number" id="roundNumber">-</span>
        </div>
        <div class="goal-info">
          <span class="goal-label">GOAL TIME</span>
          <span class="goal-value" id="goalValue">-</span>
        </div>
      </div>

      <!-- Scoreboard -->
      <div class="score-board">
        <span class="titles" id="player1">...</span>
        <span class="score" id="scoreValue">- - -</span>
        <span class="titles" id="player2">...</span>
      </div>

      <!-- Main click button + live time -->
      <button class="press-button" id="pressButton"><span>CLICK</span></button>
      <p class="press-time" id="pressTime"></p>
    </section>

    <!-- Right side: opponent, turn status, history, actions -->
    <aside class="duel-side">
      <div class="opponent-card">
        <div class="avatar">
          <img id="opponentAvatar" src="/assets/images/profile.jpg" alt="Opponent avatar">
        </div>
        <span class="opponent-label">OPPONENT:</span>
        <span class="opponent-name" id="opponentName">...</span>
      </div>

      <!-- Announced to screen readers when it changes -->
      <div class="turn-status" id="turnStatus" role="status" aria-live="polite">
        Loading...
      </div>

      <!-- Per-round log -->
      <div class="history-section">
        <h3 class="titles">History</h3>
        <ul class="history-list" id="historyList">
          <li class="history-empty" id="historyEmpty">No rounds yet.</li>
        </ul>
      </div>

      <!-- Surrender action -->
      <div class="side-actions">
        <div class="side-divider" aria-hidden="true"></div>
        <button class="btn btn--secondary btn--surrender" id="surrenderBtn">SURRENDER</button>
      </div>
    </aside>

  </div>

  <!-- Round result popup -->
  <div class="modal-overlay" id="winnerPopup">
    <div class="modal-content">
      <h2 id="winnerTitle">Round Results</h2>
      <p id="winnerDetails"></p>
      <div class="popup-actions">
        <button class="btn btn-cancel" id="surrenderPopupBtn">Surrender</button>
        <button class="btn btn-confirm" id="nextRoundBtn">Next Round</button>
      </div>
    </div>
  </div>

  <!-- Final result popup (modal dialog) -->
  <div class="modal-overlay" id="finalPopup">
    <div class="modal-content" role="dialog" aria-labelledby="finalTitle" aria-modal="true">
      <h2 id="finalTitle">Final Results</h2>
      <p id="finalDetails"></p>
      <div class="popup-actions">
        <button type="button" class="btn btn-cancel" id="rematchBtn">Rematch</button>
        <a href="/pages/homeLogged.html" class="btn btn-confirm" id="returnHomeBtn" role="button">
          Return Home
        </a>
      </div>
    </div>
  </div>

  <!-- Are you still there popup -->
  <div class="modal-overlay" id="stillTherePopup">
    <div class="modal-content" role="dialog" aria-labelledby="stillThereTitle" aria-modal="true">
      <h2 id="stillThereTitle">Are You Still There?</h2>
      <p id="stillThereDetails">The goal time has passed and you haven't clicked yet. Are you still playing?</p>
      <div class="popup-actions">
        <button type="button" class="btn btn-cancel" id="forfeitBtn">Forfeit</button>
        <button type="button" class="btn btn-confirm" id="stillPlayingBtn">I'm Still Here!</button>
      </div>
    </div>
  </div>

  <!-- Rematch request popup -->
  <div class="modal-overlay" id="rematchRequestPopup">
    <div class="modal-content" role="dialog" aria-labelledby="rematchRequestTitle" aria-modal="true">
      <h2 id="rematchRequestTitle">Rematch Request</h2>
      <p id="rematchRequestDetails"></p>
      <div class="popup-actions">
        <button type="button" class="btn btn-cancel" id="declineRematchBtn">Decline</button>
        <button type="button" class="btn btn-confirm" id="acceptRematchBtn">Accept Rematch!</button>
      </div>
    </div>
  </div>

  <!-- Rematch declined popup -->
  <div class="modal-overlay" id="rematchDeclinedPopup">
    <div class="modal-content" role="dialog" aria-labelledby="rematchDeclinedTitle" aria-modal="true">
      <h2 id="rematchDeclinedTitle">Rematch Declined</h2>
      <p id="rematchDeclinedDetails">Sorry, your opponent doesn't want a rematch.</p>
      <div class="popup-actions">
        <a href="/pages/homeLogged.html" class="btn btn-confirm" role="button">
          Return Home
        </a>
      </div>
    </div>
  </div>

  <!-- Guest waiting popup -->
  <div class="modal-overlay" id="guestWaitingPopup">
    <div class="modal-content" role="dialog" aria-labelledby="guestWaitingTitle" aria-modal="true">
      <h2 id="guestWaitingTitle">WAITING FOR PLAYER...</h2>
      <p id="guestWaitingDetails">Waiting for <strong id="guestWaitingOpponent">Player</strong> to accept...</p>
    </div>
  </div>

  <!-- Challenge accept popup (for registered player) -->
  <div class="modal-overlay" id="challengeAcceptPopup">
    <div class="modal-content" role="dialog" aria-labelledby="challengeAcceptTitle" aria-modal="true">
      <h2 id="challengeAcceptTitle">NEW CHALLENGE!</h2>
      <p id="challengeAcceptDetails">A guest player has challenged you to a duel!</p>
      <div class="popup-actions">
        <button class="btn btn-confirm" id="acceptChallengeBtn">Accept</button>
        <button class="btn btn-cancel" id="declineChallengeBtn">Decline</button>
      </div>
    </div>
  </div>
</main>

<!-- Duel game logic -->
<script src="/js/pages/duel.js"></script>
</body>
</html>
